import{u as D,j as e,i as P,b as A,a as F,c as v,g as L,d as R}from"./index-e5c327bf.js";import{r as n}from"./vendor-26985c70.js";import{P as z,L as B,g as f,h as O,X as K,i as U,T as X}from"./ui-122c614a.js";import"./router-3413067a.js";import"./supabase-101da91f.js";const Q=()=>{const{user:t}=D(),[d,w]=n.useState([]),[y,j]=n.useState(!0),[p,x]=n.useState(!1),[k,u]=n.useState(null),[l,b]=n.useState({name:"",bankName:""}),[i,o]=n.useState({name:"",bankName:""}),[c,h]=n.useState({show:!1,machineId:"",machineName:"",hasTransactions:!1}),m=async()=>{if(t){j(!0);try{await P(t.id),w(await A(t.id))}catch(a){console.error("Error fetching machines:",a)}finally{j(!1)}}};n.useEffect(()=>{m()},[t]);const C=async()=>{if(!l.name||!t)return;const a={id:F(),userid:t.id,name:l.name,bankname:l.bankName,active:!0};try{await v(a),await m(),b({name:"",bankName:""}),x(!1)}catch(s){console.error("Error adding machine:",s),alert("Failed to add the machine. Please try again.")}},M=async a=>{if(t)try{const g=(await L(t.id)).some(N=>N.machineId===a),r=d.find(N=>N.id===a);h({show:!0,machineId:a,machineName:(r==null?void 0:r.name)||"Unknown Machine",hasTransactions:g})}catch(s){console.error("Error checking machine transactions:",s),alert("Failed to check machine status. Please try again.")}},S=async()=>{try{await R(c.machineId),await m(),h({show:!1,machineId:"",machineName:"",hasTransactions:!1})}catch(a){console.error("Error deleting machine:",a),alert("Failed to delete the machine. Please try again.")}},E=a=>{u(a.id),o({name:a.name,bankName:a.bankname})},I=async a=>{if(!i.name||!t)return;const s=d.find(r=>r.id===a);if(!s)return;const g={...s,name:i.name,bankname:i.bankName};try{await v(g),await m(),u(null)}catch(r){console.error("Error updating machine:",r),alert("Failed to update the machine. Please try again.")}},T=()=>{u(null),o({name:"",bankName:""})};return e.jsxs("div",{className:"max-w-2xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800",children:"Machines"}),e.jsx("p",{className:"text-slate-500",children:"Manage your card terminals."})]}),e.jsxs("button",{onClick:()=>x(!p),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"})," Add Machine"]})]}),p&&e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md border border-blue-100 mb-6 animate-in slide-in-from-top-4",children:[e.jsx("h3",{className:"font-semibold text-slate-800 mb-4",children:"New Terminal Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Machine Name / ID"}),e.jsx("input",{type:"text",className:"w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g., POS Front Desk",value:l.name,onChange:a=>b({...l,name:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Settlement Bank"}),e.jsx("input",{type:"text",className:"w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"e.g., Chase",value:l.bankName,onChange:a=>b({...l,bankName:a.target.value})})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-md",children:"Cancel"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Machine"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:y?e.jsx("div",{className:"p-8 text-center text-slate-400",children:e.jsx(B,{className:"w-6 h-6 mx-auto animate-spin"})}):d.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-400",children:[e.jsx(f,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:"No machines configured yet. Add your first one!"})]}):e.jsx("div",{className:"divide-y divide-slate-100",children:d.map(a=>e.jsx("div",{className:"p-4 group hover:bg-slate-50",children:k===a.id?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-slate-100 p-3 rounded-full text-slate-500",children:e.jsx(f,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",value:i.name,onChange:s=>o({...i,name:s.target.value}),className:"p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Machine name"}),e.jsx("input",{type:"text",value:i.bankName,onChange:s=>o({...i,bankName:s.target.value}),className:"p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Bank name"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(a.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Save",children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:T,className:"p-2 text-slate-400 hover:bg-slate-100 rounded-full transition-colors",title:"Cancel",children:e.jsx(K,{className:"w-4 h-4"})})]})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-slate-100 p-3 rounded-full text-slate-500",children:e.jsx(f,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-800",children:a.name}),e.jsx("p",{className:"text-sm text-slate-500",children:a.bankname})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(a),className:"p-2 text-slate-400 hover:text-blue-500 hover:bg-blue-50 rounded-full transition-colors",title:"Edit",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(a.id),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-full transition-colors",title:"Remove",children:e.jsx(X,{className:"w-4 h-4"})})]})]})},a.id))})}),c.show&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-4",children:c.hasTransactions?"Cannot Delete Machine":"Delete Machine"}),c.hasTransactions?e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 mb-6",children:["Cannot delete ",e.jsx("strong",{children:c.machineName})," because it has transaction history. You can only delete machines that have never been used."]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>h({show:!1,machineId:"",machineName:"",hasTransactions:!1}),className:"px-4 py-2 bg-blue-500 text-white hover:bg-blue-600 rounded-lg transition-colors",children:"OK"})})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-slate-600 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:c.machineName}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>h({show:!1,machineId:"",machineName:"",hasTransactions:!1}),className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded-lg transition-colors",children:"Delete"})]})]})]})})]})};export{Q as MachineSettings};
